----CASIS_DOCUMENT add and undo process
--
----add atrributes
----ALTER TABLE casis_mgr.CASIS_DOCUMENT ADD(ID NUMBER (18,0) DEFAULT 1);
--CREATE SEQUENCE "CASIS_DOCUMENT_SEQU"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 100 NOORDER NOCYCLE ;
--UPDATE CASIS_MGR.CASIS_DOCUMENT SET ID=CASIS_DOCUMENT_SEQU.NEXTVAL;
--
----ALTER TABLE casis_mgr.CASIS_DOCUMENT ADD CONSTRAINT PK_DOCUMENT PRIMARY KEY (ID);
--
----ALTER TABLE CASIS_MGR.CASIS_DOCUMENT ADD(VERSION NUMBER (9,0) DEFAULT 1 );
--
--UPDATE CASIS_MGR.CASIS_DOCUMENT SET VERSION=1; --not the default value -need update the value in trigger. 
--
----ALTER TABLE CASIS_MGR.CASIS_DOCUMENT ADD(UPDATE_TIMESTAMP TIMESTAMP(3) DEFAULT SYSDATE);
--
--UPDATE CASIS_MGR.CASIS_DOCUMENT SET UPDATE_TIMESTAMP=SYSDATE; --not the default value -need update the value in trigger. 


--add trigger:
--create or replace 
--TRIGGER CASIS_DOCUMENT
--BEFORE INSERT OR UPDATE OR DELETE 
--ON CASIS_DOCUMENT
--REFERENCING NEW AS NEW OLD AS OLD FOR EACH ROW
--BEGIN
--    IF INSERTING then
--        SELECT CASIS_DOCUMENT_SEQU.NEXTVAL INTO :NEW.ID FROM DUAL;   
--    ELSIF UPDATING then
--        :NEW.Version := :OLD.Version +1;
--    ELSE
--        NULL;
--    END IF;
--    EXCEPTION
--      WHEN OTHERS THEN
--        NULL;
--END; 

--test Insert 
INSERT INTO CASIS_DOCUMENT (DOCNO,SRC_DB,PART,UPD,DATEINSERTED) VALUES ('1111111','ANTIBASE',10,20140611,TO_TIMESTAMP('17-JUN-14','DD-MON-RR HH.MI.SSXFF AM'));
-- test update
UPDATE CASIS_DOCUMENT SET ID = ID +1 WHERE DOCNO='1111111';
--Display
SELECT * FROM CASIS_DOCUMENT WHERE DOCNO='1111111';
--count
SELECT COUNT(*) FROM CASIS_DOCUMENT;
--delete the row
DELETE FROM CASIS_DOCUMENT WHERE DOCNO='1111111';

