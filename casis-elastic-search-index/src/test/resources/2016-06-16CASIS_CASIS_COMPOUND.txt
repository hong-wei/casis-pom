--CASIS_COMPOUND add and undo process

--add columns
-- add ID
ALTER TABLE casis_mgr.CASIS_COMPOUND ADD(ID NUMBER (18,0)); 
CREATE SEQUENCE "CASIS_COMPOUND_SEQU"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 100 NOORDER NOCYCLE ;
UPDATE CASIS_MGR.CASIS_COMPOUND SET ID=CASIS_COMPOUND_SEQU.NEXTVAL;
ALTER TABLE CASIS_MGR.CASIS_COMPOUND ADD CONSTRAINT PK_COMPOUND PRIMARY KEY (ID);
-- add version
ALTER TABLE CASIS_MGR.CASIS_COMPOUND ADD(VERSION NUMBER (9,0));
UPDATE CASIS_MGR.CASIS_COMPOUND SET VERSION=1;
-- add time_stamp
ALTER TABLE CASIS_MGR.CASIS_COMPOUND ADD(UPDATE_TIMESTAMP TIMESTAMP(3));
UPDATE CASIS_MGR.CASIS_COMPOUND SET UPDATE_TIMESTAMP=SYSDATE; 


----add trigger:
--create or replace 
--TRIGGER CASIS_COMPOUND
--BEFORE INSERT OR UPDATE OR DELETE 
--ON CASIS_COMPOUND
--REFERENCING NEW AS NEW OLD AS OLD FOR EACH ROW
--BEGIN
--    IF INSERTING then
--        SELECT CASIS_COMPOUND_SEQU.NEXTVAL INTO :NEW.ID FROM DUAL;
--        :NEW.Version := 1;
--        :NEW.UPDATE_TIMESTAMP := SYSDATE; 
--    ELSIF UPDATING then
--        :NEW.Version := :OLD.Version +1;
--    ELSE
--        NULL;
--    END IF;
--    EXCEPTION
--      WHEN OTHERS THEN
--        NULL;
--END; 

--test Insert 
INSERT INTO CASIS_COMPOUND (DOCNO,SRC_DB,CN) VALUES ('1111111','PHP','Glutoxim (IM)');
-- test update
UPDATE CASIS_COMPOUND SET ID = ID +1 WHERE DOCNO='1111111';
--Display
SELECT * FROM CASIS_COMPOUND WHERE DOCNO='1111111';
--count
SELECT COUNT(*) FROM CASIS_COMPOUND;
--delete the row
DELETE FROM CASIS_COMPOUND WHERE DOCNO='1111111';

