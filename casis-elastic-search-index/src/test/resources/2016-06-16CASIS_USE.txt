--CASIS_USE add and undo process

--add columns
-- add ID
ALTER TABLE casis_mgr.CASIS_USE ADD(ID NUMBER (18,0)); 
CREATE SEQUENCE "CASIS_USE_SEQU"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 100 NOORDER NOCYCLE ;
UPDATE CASIS_MGR.CASIS_USE SET ID=CASIS_USE_SEQU.NEXTVAL;
ALTER TABLE CASIS_MGR.CASIS_USE ADD CONSTRAINT PK_USE PRIMARY KEY (ID);
-- add version
ALTER TABLE CASIS_MGR.CASIS_USE ADD(VERSION NUMBER (9,0));
UPDATE CASIS_MGR.CASIS_USE SET VERSION=1;
-- add time_stamp
ALTER TABLE CASIS_MGR.CASIS_USE ADD(UPDATE_TIMESTAMP TIMESTAMP(3));
UPDATE CASIS_MGR.CASIS_USE SET UPDATE_TIMESTAMP=SYSDATE; 


----add trigger:
--create or replace 
--TRIGGER CASIS_USE
--BEFORE INSERT OR UPDATE OR DELETE 
--ON CASIS_USE
--REFERENCING NEW AS NEW OLD AS OLD FOR EACH ROW
--BEGIN
--    IF INSERTING then
--        SELECT CASIS_USE_SEQU.NEXTVAL INTO :NEW.ID FROM DUAL;
--        :NEW.Version := 1;
--        :NEW.UPDATE_TIMESTAMP := SYSDATE; 
--    ELSIF UPDATING then
--        :NEW.Version := :OLD.Version +1;
--    ELSE
--        NULL;
--    END IF;
--    EXCEPTION
--      WHEN OTHERS THEN
--        NULL;
--END; 

--test Insert 
Insert into CASIS_USE (DOCNO,SRC_DB,THE_USE,CODE,SOURCE) values ('1111111','DGL','Tratamiento de la dermatomicosis',null,'IND');
-- test update
UPDATE CASIS_USE SET ID = ID +1 WHERE DOCNO='1111111';
--Display
SELECT * FROM CASIS_USE WHERE DOCNO='1111111';
--count
SELECT COUNT(*) FROM CASIS_USE;
--delete the row
DELETE FROM CASIS_USE WHERE DOCNO='1111111';

