--CASIS_DEVSTATUS add and undo process

--add columns
-- add ID
ALTER TABLE casis_mgr.CASIS_DEVSTATUS ADD(ID NUMBER (18,0)); 
CREATE SEQUENCE "CASIS_DEVSTATUS_SEQU"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 100 NOORDER NOCYCLE ;
UPDATE CASIS_MGR.CASIS_DEVSTATUS SET ID=CASIS_DEVSTATUS_SEQU.NEXTVAL;
ALTER TABLE CASIS_MGR.CASIS_DEVSTATUS ADD CONSTRAINT PK_DEVSTATUS PRIMARY KEY (ID);
-- add version
ALTER TABLE CASIS_MGR.CASIS_DEVSTATUS ADD(VERSION NUMBER (9,0));
UPDATE CASIS_MGR.CASIS_DEVSTATUS SET VERSION=1;
-- add time_stamp
ALTER TABLE CASIS_MGR.CASIS_DEVSTATUS ADD(UPDATE_TIMESTAMP TIMESTAMP(3));
UPDATE CASIS_MGR.CASIS_DEVSTATUS SET UPDATE_TIMESTAMP=SYSDATE; 


----add trigger:
--create or replace 
--TRIGGER CASIS_DEVSTATUS
--BEFORE INSERT OR UPDATE OR DELETE 
--ON CASIS_DEVSTATUS
--REFERENCING NEW AS NEW OLD AS OLD FOR EACH ROW
--BEGIN
--    IF INSERTING then
--        SELECT CASIS_DEVSTATUS_SEQU.NEXTVAL INTO :NEW.ID FROM DUAL;
--        :NEW.Version := 1;
--        :NEW.UPDATE_TIMESTAMP := SYSTIMESTAMP; 
--    ELSIF UPDATING then
--        :NEW.Version := :OLD.Version +1;
--    ELSE
--        NULL;
--    END IF;
--    EXCEPTION
--      WHEN OTHERS THEN
--        NULL;
--END; 

--test Insert 
INSERT INTO CASIS_DEVSTATUS (DOCNO,SRC_DB,DSTA,COUNTRY) VALUES ('1111111','PHP','Licensing Availability Unknown','SF');
-- test update
UPDATE CASIS_DEVSTATUS SET ID = ID +1 WHERE DOCNO='1111111';
--Display
SELECT * FROM CASIS_DEVSTATUS WHERE DOCNO='1111111';
--count
SELECT COUNT(*) FROM CASIS_DEVSTATUS;
--delete the row
DELETE FROM CASIS_DEVSTATUS WHERE DOCNO='1111111';

