CREATE TABLE "CASIS_MGR"."CASIS2_BG_INGEST_RUNS2"
  (
    "RUN_ID"                  NUMBER(10,0),
    "START_TS"                TIMESTAMP (6),
    "END_TS"                  TIMESTAMP (6),
    "LAST_INGESTED_RECORD_TS" TIMESTAMP (6),
    "LOADING_PROCESS_ACTIVE"  CHAR(1 BYTE)
  )
SEGMENT CREATION DEFERRED PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 NOCOMPRESS LOGGING TABLESPACE "CASIS" ;

--sequence for run_id and set the sequence to talbe  
CREATE SEQUENCE "CASIS2_BG_INGEST_RUNS2_SEQU"  MINVALUE 1 MAXVALUE 999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 100 NOORDER NOCYCLE ;
UPDATE CASIS_MGR.CASIS2_BG_INGEST_RUNS2 SET RUN_ID=CASIS2_BG_INGEST_RUNS2_SEQU.NEXTVAL;

--trriger
create or replace 
TRIGGER CASIS2_BG_INGEST_RUNS2
BEFORE INSERT OR UPDATE OR DELETE 
ON CASIS2_BG_INGEST_RUNS2
REFERENCING NEW AS NEW OLD AS OLD FOR EACH ROW
BEGIN
    IF INSERTING THEN
        SELECT CASIS2_BG_INGEST_RUNS2_SEQU.NEXTVAL INTO :NEW.RUN_ID FROM DUAL;
    ELSE
        NULL;
    END IF;
    EXCEPTION
      WHEN OTHERS THEN
        NULL;
END;
/

INSERT INTO CASIS2_BG_INGEST_RUNS2 (START_TS) VALUES (TO_TIMESTAMP('16-JUN-16 12.29.10.000000000 PM','DD-MON-RR HH.MI.SS.FF AM'));
INSERT INTO CASIS2_BG_INGEST_RUNS2 (START_TS,LOADING_PROCESS_ACTIVE) VALUES (SYSTIMESTAMP,'n'); 

--delete all rows
DELETE CASIS2_BG_INGEST_RUNS2 ;
--check all the tables
select * from CASIS2_BG_INGEST_RUNS2;   


--undo
DROP TABLE "CASIS_MGR"."CASIS2_BG_INGEST_RUNS2" ;
drop sequence "CASIS_MGR"."CASIS2_BG_INGEST_RUNS2_SEQU";



SELECT * FROM CASIS_DOCUMENT 
where UPDATE_TIMESTAMP in (select max(UPDATE_TIMESTAMP) from CASIS_DOCUMENT);
